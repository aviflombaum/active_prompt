<div class="admin-header">
  <div>
    <h1>Test Prompt: <%= @prompt.name %></h1>
    <p class="text-muted">Test your prompt with real AI providers</p>
  </div>
</div>

<div class="card">
  <div class="card__header">
    <h3 class="card__title">Playground Settings</h3>
  </div>
  <div class="card__body">
    <%= form_with url: playground_prompt_path(@prompt), method: :post, local: true, html: { class: "form" } do |form| %>
      <div class="form__group">
        <%= form.label :provider, "AI Provider", class: "form__label form__label--required" %>
        <% 
          # Determine default provider based on prompt's model
          default_provider = case @prompt.model
                           when /claude/i, /anthropic/i
                             "anthropic"
                           when /gpt/i, /openai/i
                             "openai"
                           else
                             nil
                           end
        %>
        <%= form.select :provider,
            options_for_select([
              ["Anthropic (claude-3-5-sonnet-20241022)", "anthropic"],
              ["OpenAI (gpt-4o)", "openai"]
            ], default_provider),
            { prompt: "Select a provider" },
            class: "form__select", required: true %>
        <div class="form__help">
          <% if @prompt.model.present? %>
            Prompt is configured for <%= @prompt.model %>
          <% else %>
            Select which AI provider to test with
          <% end %>
        </div>
      </div>

      <div class="form__group">
        <%= form.label :api_key, "API Key", class: "form__label form__label--required" %>
        <%= form.password_field :api_key, class: "form__input", required: true,
            placeholder: "Enter your API key" %>
        <div class="form__help">Your API key will not be stored</div>
      </div>

      <% if @parameters.any? %>
        <h3 class="form__section-title">Prompt Parameters</h3>
        <div class="form__help mb-md">Fill in the values for each parameter:</div>
        
        <% @parameters.each do |parameter_name| %>
          <div class="form__group">
            <%= form.label "parameters[#{parameter_name}]", parameter_name.humanize.titleize, class: "form__label" %>
            <%= form.text_area "parameters[#{parameter_name}]", 
                class: "form__textarea",
                rows: 3,
                placeholder: "Enter value for #{parameter_name}" %>
          </div>
        <% end %>
      <% end %>

      <div class="form__actions">
        <%= link_to "Cancel", prompt_path(@prompt), class: "btn btn--secondary btn--medium" %>
        <%= form.submit "Test Prompt", class: "btn btn--primary btn--medium" %>
      </div>
    <% end %>
  </div>
</div>